--- time-1.7/resuse.h.orig	Wed Jun 12 19:36:54 1996
+++ time-1.7/resuse.h	Fri Aug  8 13:49:13 2003
@@ -36,7 +36,7 @@
 # include <sys/rusage.h>
 #else
 # define TV_MSEC tv_usec / 1000
-# if HAVE_WAIT3
+# if HAVE_WAIT3 || HAVE_SYS_RESOURCE_H
 #  include <sys/resource.h>
 # else
 /* Process resource usage structure.  */
--- time-1.7/configure.in.orig	Wed Jun 12 19:07:06 1996
+++ time-1.7/configure.in	Fri Aug  8 13:51:27 2003
@@ -1,9 +1,6 @@
 dnl Process this file with autoconf to produce a configure script.
-AC_INIT(time.c)
-VERSION=1.7
-AC_SUBST(VERSION)
-PACKAGE=time
-AC_SUBST(PACKAGE)
+AC_INIT(time, 1.7)
+AM_INIT_AUTOMAKE
 
 AC_ARG_PROGRAM
 
@@ -15,7 +12,7 @@
 dnl Checks for header files.
 AC_HEADER_STDC
 AC_HEADER_SYS_WAIT
-AC_CHECK_HEADERS(unistd.h string.h sys/rusage.h)
+AC_CHECK_HEADERS(unistd.h string.h sys/rusage.h sys/resource.h)
 
 dnl Checks for typedefs, structures, and compiler characteristics.
 AC_C_CONST
@@ -27,7 +27,54 @@
 
 dnl Checks for library functions.
 AC_FUNC_VPRINTF
-AC_FUNC_WAIT3
+
+AC_CACHE_CHECK([for wait3 that fills in rusage],
+               [ac_cv_func_wait3_rusage],
+[AC_RUN_IFELSE([AC_LANG_SOURCE(
+[[#include <sys/types.h>
+#include <sys/time.h>
+#include <sys/resource.h>
+#include <stdio.h>
+/* HP-UX has wait3 but does not fill in rusage at all.  */
+int
+main ()
+{
+  struct rusage r;
+  int i;
+  /* Use a field that we can force nonzero --
+     voluntary context switches.
+     For systems like NeXT and OSF/1 that don't set it,
+     also use the system CPU time.  And page faults (I/O) for Linux.  */
+  r.ru_nvcsw = 0;
+  r.ru_stime.tv_sec = 999;
+  r.ru_stime.tv_usec = 0;
+  r.ru_majflt = r.ru_minflt = 0;
+  switch (fork ())
+    {
+    case 0: /* Child.  */
+      sleep(1); /* Give up the CPU.  */
+      _exit(0);
+      break;
+    case -1: /* What can we do?  */
+      _exit(0);
+      break;
+    default: /* Parent.  */
+      wait3(&i, 0, &r);
+      /* Avoid "text file busy" from rm on fast HP-UX machines.  */
+      sleep(2);
+      exit (r.ru_nvcsw == 0 && r.ru_majflt == 0 && r.ru_minflt == 0
+	    && r.ru_stime.tv_sec == 999 && r.ru_stime.tv_usec == 0);
+    }
+}]])],
+               [ac_cv_func_wait3_rusage=yes],
+               [ac_cv_func_wait3_rusage=no],
+               [ac_cv_func_wait3_rusage=no])])
+if test $ac_cv_func_wait3_rusage = yes; then
+  AC_DEFINE(HAVE_WAIT3, 1,
+            [Define to 1 if you have the `wait3' system call.
+             Deprecated, you should no longer depend upon `wait3'.])
+fi
+
 AC_CHECK_FUNCS(strerror)
 
 AC_MSG_CHECKING(for getpagesize)
